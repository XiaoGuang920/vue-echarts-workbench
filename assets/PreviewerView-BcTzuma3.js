import{d as Ne,r as c,c as Ie,o as Me,x as Oe,a as i,b as u,e as o,w as he,g as d,h as b,u as f,y as ze,j as Te,F as y,f as A,i as be,z as Le,A as Pe,n as ye,m as D,l as U,v as $,p as He,t as w,B as Fe,C as Je,E as We,G as Be,H as Qe,I as Ke,J as qe,K as P,L as Ze,M as et,k as H,Q as te,N as we,O as ke,P as tt,T as xe,R as Se,S as lt,U as at,D as nt,V as ot,_ as st}from"./index-DQCdY4Vz.js";const rt={class:"container"},ut={key:0,class:"flex h-[50vh] flex-col items-center justify-center gap-2 p-4 text-xl font-bold text-[#374151]"},it={class:"scroll-container"},ct={class:"grid h-full gap-4 sm:grid-cols-2"},dt={class:"input-title"},vt={class:"input-content"},ft=["placeholder","onUpdate:modelValue"],pt=["placeholder","onUpdate:modelValue"],gt=["placeholder","onUpdate:modelValue"],mt=["placeholder","onUpdate:modelValue"],ht=["onClick"],bt=["value","onUpdate:modelValue"],yt=["onClick"],wt=["value","onUpdate:modelValue"],kt={class:"popup-footer"},xt={class:"flex gap-4"},St={class:"align-center flex justify-between border-b border-[#e5e7eb] bg-[#f9fafb] p-4"},Ct={class:"relative min-h-0 flex-1"},Vt={key:0,class:"absolute bottom-0 left-0 flex w-full items-center gap-2 bg-red-200 p-2 text-base text-red-400"},Et={class:"grid flex-shrink-0 grid-flow-row gap-4 border-t border-[#e5e7eb] bg-[#f9fafb] p-4"},_t={class:"flex h-10 w-full gap-4"},Dt={class:"flex h-10 w-full gap-4"},Xt={class:"flex h-10 w-full gap-4"},Yt={class:"relative flex items-center gap-2 rounded-full bg-[#DDDDDD] px-8 py-4 text-base text-[#44444e] shadow-lg"},jt={class:"w-fit flex-shrink-0 font-bold"},At={class:"filter-tag-container"},$t={class:"filter-tag-text"},Gt=["onMousedown","on:touchStart"],Rt=Ne({__name:"PreviewerView",setup(Ut){const p=c([]),x=c([]),F=c(!1),J=c(!1),X=c({}),_=c({}),Y=c({}),S=c({}),C=c({}),V=c({}),k=c({}),r=c({}),N=c({}),le=c({}),m=c({}),ae=c({}),W=c(),E=c(180),h=c(""),G=c(""),B=c(),Q=c(),I=c(""),v=c({isDragging:!1,activeIndex:-1,startX:0,startY:0,startGridX:0,startGridY:0,currentX:0,currentY:0,previewGridX:0,previewGridY:0}),Ce=Ie(()=>h.value?Math.max(1,h.value.split(`
`).length):1);function ne(t,e){t.preventDefault(),t.stopPropagation();const l="touches"in t?t.touches[0].clientX:t.clientX,a="touches"in t?t.touches[0].clientY:t.clientY,n=x.value[e];v.value={isDragging:!0,activeIndex:e,startX:l,startY:a,startGridX:n.gridX||1,startGridY:n.gridY||1,currentX:l,currentY:a,previewGridX:n.gridX||1,previewGridY:n.gridY||1},document.addEventListener("mousemove",M),document.addEventListener("mouseup",O),document.addEventListener("touchmove",M,{passive:!1}),document.addEventListener("touchend",O),document.body.style.cursor="grabbing",document.body.style.userSelect="none"}function M(t){if(!v.value.isDragging)return;t.preventDefault();const e="touches"in t?t.touches[0].clientX:t.clientX,l="touches"in t?t.touches[0].clientY:t.clientY;v.value.currentX=e,v.value.currentY=l;const a=e-v.value.startX,n=l-v.value.startY,s=Math.round(a/(E.value+24)),g=Math.round(n/(E.value+24)),ee=Math.max(1,v.value.startGridX+s),j=Math.max(1,v.value.startGridY+g);v.value.previewGridX=ee,v.value.previewGridY=j}function O(){if(!v.value.isDragging)return;const t=x.value[v.value.activeIndex];if(t){const l=v.value.previewGridX,a=v.value.previewGridY;Ve(v.value.activeIndex,l,a)&&(t.gridX=l,t.gridY=a)}const e={filters:p.value,charts:x.value};h.value=JSON.stringify(e,null,2),G.value="",document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",O),document.removeEventListener("touchmove",M),document.removeEventListener("touchend",O),document.body.style.cursor="",document.body.style.userSelect="",v.value={isDragging:!1,activeIndex:-1,startX:0,startY:0,startGridX:0,startGridY:0,currentX:0,currentY:0,previewGridX:0,previewGridY:0}}function Ve(t,e,l){const a=x.value[t];if(!a)return!1;const n=a.gridWidth||4,s=a.gridHeight||4;return!x.value.some((g,ee)=>{if(ee===t)return!1;const j={x1:e,y1:l,x2:e+n,y2:l+s},L={x1:g.gridX||1,y1:g.gridY||1,x2:(g.gridX||1)+(g.gridWidth||4),y2:(g.gridY||1)+(g.gridHeight||4)};return!(j.x2<=L.x1||j.x1>=L.x2||j.y2<=L.y1||j.y1>=L.y2)})}function Ee(){if(!v.value.isDragging)return{};const t=x.value[v.value.activeIndex];if(!t)return{};const e=v.value.previewGridX,l=v.value.previewGridY,a=t.gridWidth||4,n=t.gridHeight||4,s=e+a,g=l+n;return{gridColumn:`${e} / ${s}`,gridRow:`${l} / ${g}`,minHeight:`${n*E.value}px`}}function z(){se(),F.value=!F.value}function T(){J.value=!J.value}function oe(t,e){t&&(le.value[e]=t,m.value[e]===void 0&&(m.value[e]=!1))}function K(t,e,l){t&&(l?N.value[`${e}-${l}`]=t:N.value[e]=t)}function se(){Object.keys(m.value).forEach(t=>{const e=parseInt(t,10);m.value[e]=!1})}function re(t){const e=p.value[t];(e.type==="singleSelect"||e.type==="multiSelect")&&(m.value[t]=!m.value[t],m.value[t]&&ot(()=>{ue(t)}))}function ue(t){const e=le.value[t];if(e){const l=e.getBoundingClientRect();ae.value[t]={top:l.bottom,left:l.left,width:l.width}}}function ie(t){const e=ae.value[t];return e?{position:"fixed",top:`${e.top}px`,left:`${e.left}px`,width:`${e.width}px`,zIndex:1e4}:{}}function _e(){B.value&&Q.value&&(Q.value.scrollTop=B.value.scrollTop)}function De(){Object.keys(m.value).forEach(t=>{const e=parseInt(t,10);m.value[e]=!1}),Object.keys(N.value).forEach(t=>{N.value[t]?.closeMenu()})}function Xe(){Object.keys(m.value).forEach(t=>{const e=parseInt(t,10);m.value[e]&&ue(e)})}function ce(t,e){let l;return function(){l||(t(),l=!0,setTimeout(()=>l=!1,e))}}const de=ce(Xe,200);function R(t){return t?typeof t=="string"?t:t.start:""}function ve(t){return t?typeof t=="string"?t:t.end:""}function fe(t,e){if(!e||!t.options)return"";const l=t.options.find(a=>a.value===e);return l?l.label:e}function pe(t,e){return!e||!t.options?"":e.map(l=>{const a=t.options.find(n=>n.value===l);return a?a.label:l}).filter(Boolean).join(", ")}function q(){r.value={},Object.keys(X.value).forEach(t=>{const e=parseInt(t,10);X.value[e]?(r.value[e]=X.value[e],r.value[e]=p.value[e].label+": "+r.value[e]):delete r.value[e]}),Object.keys(_.value).forEach(t=>{const e=parseInt(t,10);_.value[e]!==void 0&&_.value[e]!==null?(r.value[e]=_.value[e].toString()+p.value[e].unit,r.value[e]=p.value[e].label+": "+r.value[e]):delete r.value[e]}),Object.keys(Y.value).forEach(t=>{const e=parseInt(t,10);Y.value[e]?(r.value[e]=Y.value[e].toLocaleString(),r.value[e]=p.value[e].label+": "+r.value[e]):delete r.value[e]}),Object.keys(S.value).forEach(t=>{const e=parseInt(t,10),l=S.value[e];l&&l.start&&l.end?(r.value[e]=`${l.start.toLocaleString()} ~ ${l.end.toLocaleString()}`,r.value[e]=p.value[e].label+": "+r.value[e]):delete r.value[e]}),Object.keys(C.value).forEach(t=>{const e=parseInt(t,10),l=C.value[e];if(l&&l.start!==void 0&&l.end!==void 0){const a=p.value[e].unit;r.value[e]=`${l.start}${a} ~ ${l.end}${a}`,r.value[e]=p.value[e].label+": "+r.value[e]}else delete r.value[e]}),Object.keys(V.value).forEach(t=>{const e=parseInt(t,10),l=p.value[e];V.value[e]?(r.value[e]=fe(l,V.value[e])||V.value[e],r.value[e]=p.value[e].label+": "+r.value[e]):delete r.value[e]}),Object.keys(k.value).forEach(t=>{const e=parseInt(t,10),l=p.value[e];k.value[e]&&k.value[e].length>0?(r.value[e]=pe(l,k.value[e])||k.value[e].join(", "),r.value[e]=p.value[e].label+": "+r.value[e]):delete r.value[e]})}function Z(){X.value={},_.value={},Y.value={},S.value={},C.value={},V.value={},k.value={},p.value.forEach((t,e)=>{if(!(t.default===void 0||t.default==null))switch(t.type){case"text":X.value[e]=t.default||"";break;case"number":_.value[e]=t.default||0;break;case"date":Y.value[e]=t.default?new Date(t.default):null;break;case"dateRange":if(t.default&&typeof t.default=="object"&&!Array.isArray(t.default)){const l=t.default;S.value[e]={start:new Date(l.start),end:new Date(l.end)}}else S.value[e]={start:null,end:null};break;case"numberRange":if(t.default&&typeof t.default=="object"&&!Array.isArray(t.default)){const l=t.default;C.value[e]={start:l.start,end:l.end}}else C.value[e]={start:0,end:0};break;case"singleSelect":V.value[e]=t.default||"";break;case"multiSelect":k.value[e]=t.default||[];break}}),se()}function Ye(){q(),z()}function ge(){if(!W.value)return;const t=W.value.clientWidth;t<768||t<1024?E.value=80:t<1280?E.value=120:(t<1536,E.value=160)}function je(t){const e=t.gridX||1,l=t.gridY||1,a=t.gridWidth||4,n=t.gridHeight||4,s=e+a,g=l+n;return{gridColumn:`${e} / ${s}`,gridRow:`${l} / ${g}`,minHeight:`${n*E.value}px`}}const me=ce(ge,100);async function Ae(){try{const t="/vue-echarts-workbench/",e=t?`${t}data/pages/demo-charts.json`:"data/pages/demo-charts.json",l=await fetch(e);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const a=await l.json();h.value=JSON.stringify(a,null,2)}catch(t){console.error("Error fetching chart data:",t)}}async function $e(){if(I.value)try{const t=await fetch(I.value);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();h.value=JSON.stringify(e,null,2)}catch(t){console.error("Error fetching chart data:",t),G.value=`Error fetching chart data: ${t.message}`}}function Ge(){if(h.value.trim()==="")return;const t="data:text/json;charset=utf-8,"+encodeURIComponent(h.value),e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download","chart-configs.json"),document.body.appendChild(e),e.click(),e.remove()}function Re(){if(p.value=[],x.value=[],Z(),q(),h.value.trim()!=="")try{const t=JSON.parse(h.value);t.filters&&(p.value=t.filters),t.charts&&(x.value=t.charts),Z(),q(),T()}catch(t){console.error("Invalid JSON format:",t),G.value=`Invalid JSON format: ${t.message}`}}function Ue(){h.value=""}return Me(async()=>{ge(),window.addEventListener("resize",de),window.addEventListener("resize",me)}),Oe(()=>{window.removeEventListener("resize",de),window.removeEventListener("resize",me)}),(t,e)=>{const l=Te("FontAwesomeIcon");return u(),i("div",rt,[o("div",{class:ye(["popup-model",{active:F.value}]),onClick:z},[o("div",{class:"popup-content shadow-lg",onClick:e[2]||(e[2]=he(()=>{},["stop"]))},[p.value.length==0?(u(),i("div",ut,[d(l,{icon:f(ze),class:"mb-2 text-6xl"},null,8,["icon"]),e[6]||(e[6]=b("沒有任何篩選項 ",-1))])):(u(),i("div",{key:1,class:"popup-body",onScroll:De},[o("div",it,[o("div",ct,[(u(!0),i(y,null,A(p.value,(a,n)=>(u(),i("div",{key:n,class:"input-group"},[o("div",dt,w(a.label),1),o("div",vt,[a.type=="text"?D((u(),i("input",{key:0,class:"text-input",type:"text",placeholder:R(a.placeholder),"onUpdate:modelValue":s=>X.value[n]=s},null,8,ft)),[[$,X.value[n]]]):a.type=="date"?(u(),H(f(te),{key:1,ref_for:!0,ref:s=>K(s,n),placeholder:R(a.placeholder),modelValue:Y.value[n],"onUpdate:modelValue":s=>Y.value[n]=s,format:"yyyy-MM-dd HH:mm:ss","enable-time-picker":!0,locale:"zh-TW",teleport:!0,"z-index":1e4},null,8,["placeholder","modelValue","onUpdate:modelValue"])):a.type=="dateRange"?(u(),i(y,{key:2},[d(f(te),{ref_for:!0,ref:s=>K(s,n,"start"),placeholder:R(a.placeholder),modelValue:S.value[n].start,"onUpdate:modelValue":s=>S.value[n].start=s,format:"yyyy-MM-dd HH:mm:ss","enable-time-picker":!0,locale:"zh-TW",teleport:!0,"z-index":1e4},null,8,["placeholder","modelValue","onUpdate:modelValue"]),e[7]||(e[7]=o("span",null,"~",-1)),d(f(te),{ref_for:!0,ref:s=>K(s,n,"end"),placeholder:ve(a.placeholder),modelValue:S.value[n].end,"onUpdate:modelValue":s=>S.value[n].end=s,format:"yyyy-MM-dd HH:mm:ss","enable-time-picker":!0,locale:"zh-TW",teleport:!0,"z-index":1e4},null,8,["placeholder","modelValue","onUpdate:modelValue"])],64)):a.type=="number"?(u(),i(y,{key:3},[D(o("input",{type:"number",placeholder:R(a.placeholder),"onUpdate:modelValue":s=>_.value[n]=s},null,8,pt),[[$,_.value[n]]]),o("span",null,w(a.unit),1)],64)):a.type=="numberRange"?(u(),i(y,{key:4},[D(o("input",{type:"number",placeholder:R(a.placeholder),"onUpdate:modelValue":s=>C.value[n].start=s},null,8,gt),[[$,C.value[n].start]]),o("span",null,w(a.unit),1),e[8]||(e[8]=o("span",null,"~",-1)),D(o("input",{type:"number",placeholder:ve(a.placeholder),"onUpdate:modelValue":s=>C.value[n].end=s},null,8,mt),[[$,C.value[n].end]]),o("span",null,w(a.unit),1)],64)):a.type=="singleSelect"?(u(),i(y,{key:5},[o("div",{class:"select-title",ref_for:!0,ref:s=>oe(s,n),onClick:s=>re(n)},[o("span",null,w(fe(a,V.value[n])||a.placeholder),1),d(l,{icon:f(we)},null,8,["icon"])],8,ht),d(Se,{name:"fade",mode:"out-in"},{default:ke(()=>[(u(),H(xe,{to:"body"},[m.value[n]?(u(),i("div",{key:0,class:"select-options",style:P(ie(n))},[(u(!0),i(y,null,A(a.options,s=>(u(),i("label",{key:s.value},[D(o("input",{type:"radio",value:s.value,"onUpdate:modelValue":g=>V.value[n]=g},null,8,bt),[[tt,V.value[n]]]),o("span",null,w(s.label),1)]))),128))],4)):U("",!0)]))]),_:2},1024)],64)):a.type=="multiSelect"?(u(),i(y,{key:6},[o("div",{class:"select-title",ref_for:!0,ref:s=>oe(s,n),onClick:s=>re(n)},[o("span",null,w(pe(a,k.value[n])||a.placeholder),1),d(l,{icon:f(we)},null,8,["icon"])],8,yt),d(Se,{name:"fade",mode:"out-in"},{default:ke(()=>[(u(),H(xe,{to:"body"},[m.value[n]?(u(),i("div",{key:0,class:"select-options",style:P(ie(n))},[(u(!0),i(y,null,A(a.options,s=>(u(),i("label",{key:s.value},[D(o("input",{type:"checkbox",value:s.value,"onUpdate:modelValue":g=>k.value[n]=g},null,8,wt),[[lt,k.value[n]]]),o("span",null,w(s.label),1)]))),128))],4)):U("",!0)]))]),_:2},1024)],64)):U("",!0)])]))),128))])])],32)),o("div",kt,[o("button",{class:"flex w-[8rem] items-center justify-center rounded-full bg-gray-500 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-600",onClick:z},[d(l,{icon:f(be),class:"mr-1"},null,8,["icon"]),e[9]||(e[9]=b("關閉 ",-1))]),o("div",xt,[o("button",{class:"flex w-[8rem] items-center justify-center rounded-full bg-blue-400 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-500",onClick:e[0]||(e[0]=a=>Z())},[d(l,{icon:f(Le),class:"mr-1"},null,8,["icon"]),e[10]||(e[10]=b("重置 ",-1))]),o("button",{class:"flex w-[8rem] items-center justify-center rounded-full bg-blue-500 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-600",onClick:e[1]||(e[1]=a=>Ye())},[d(l,{icon:f(Pe),class:"mr-1"},null,8,["icon"]),e[11]||(e[11]=b("套用 ",-1))])])])])],2),o("div",{class:ye(["chart-settings popup-model",{active:J.value}]),onClick:T},[o("div",{class:"popup-content flex h-full flex-col",onClick:e[5]||(e[5]=he(()=>{},["stop"]))},[o("div",St,[e[12]||(e[12]=o("span",{class:"text-base font-bold text-[#44444e]"},"JSON 編輯器",-1)),o("button",{class:"text-[#44444e]",onClick:T},[d(l,{icon:f(be)},null,8,["icon"])])]),o("div",Ct,[o("div",{ref_key:"lineNumbersRef",ref:Q,class:"absolute left-0 top-0 h-full overflow-hidden bg-gray-100 text-right text-base text-gray-500"},[(u(!0),i(y,null,A(Ce.value,a=>(u(),i("div",{key:a,class:"px-2"},w(a),1))),128))],512),D(o("textarea",{ref_key:"textareaRef",ref:B,class:"ml-14 h-full w-full resize-none bg-transparent p-0 text-base text-[#37353E] outline-none",placeholder:"在此編輯 ECharts 配置...","onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),onScroll:_e,spellcheck:"false"},null,544),[[$,h.value]]),G.value?(u(),i("div",Vt,[d(l,{icon:f(He)},null,8,["icon"]),b(" "+w(G.value),1)])):U("",!0)]),o("div",Et,[o("div",_t,[D(o("input",{class:"w-4/5 rounded border border-gray-300 px-3 py-2",type:"text",placeholder:"請輸入 API","onUpdate:modelValue":e[4]||(e[4]=a=>I.value=a)},null,512),[[$,I.value]]),o("button",{class:"flex h-10 w-1/5 items-center justify-center gap-2 rounded-md bg-[#59AC77] px-4 py-2 text-sm font-semibold text-white hover:bg-[#3A6F43]",onClick:$e},[d(l,{icon:f(Fe)},null,8,["icon"]),e[13]||(e[13]=b("測試 ",-1))])]),o("div",Dt,[o("button",{class:"flex h-10 w-1/2 items-center justify-center gap-2 rounded-md bg-[#456882] px-4 py-2 text-sm font-semibold text-white hover:bg-[#234C6A]",onClick:Ae},[d(l,{icon:f(Je)},null,8,["icon"]),e[14]||(e[14]=b("載入範例 ",-1))]),o("button",{class:"flex h-10 w-1/2 items-center justify-center gap-2 rounded-md bg-[#456882] px-4 py-2 text-sm font-semibold text-white hover:bg-[#234C6A]",onClick:Ge},[d(l,{icon:f(We)},null,8,["icon"]),e[15]||(e[15]=b("下載 JSON ",-1))])]),o("div",Xt,[o("button",{class:"flex h-10 w-1/2 items-center justify-center gap-2 rounded-md bg-gray-500 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-600",onClick:Ue},[d(l,{icon:f(Be)},null,8,["icon"]),e[16]||(e[16]=b("重製 ",-1))]),o("button",{class:"flex h-10 w-1/2 items-center justify-center gap-2 rounded-md bg-[#456882] px-4 py-2 text-sm font-semibold text-white hover:bg-[#234C6A]",onClick:Re},[d(l,{icon:f(Qe)},null,8,["icon"]),e[17]||(e[17]=b("套用 ",-1))])])])])],2),o("div",Yt,[o("span",jt,[d(l,{icon:f(Ke),class:"text-[#456882]"},null,8,["icon"]),e[18]||(e[18]=b(" 篩選項 ",-1))]),o("div",At,[(u(!0),i(y,null,A(r.value,(a,n)=>(u(),i("div",{class:"filter-tag",key:n},[e[19]||(e[19]=o("div",{class:"filter-tag-hole"},null,-1)),o("span",$t,w(a),1)]))),128))]),o("button",{class:"text-base text-[#456882]",onClick:z},[d(l,{icon:f(qe)},null,8,["icon"])])]),o("div",{ref_key:"chartGridRef",ref:W,class:"chart-grid mt-6"},[v.value.isDragging?(u(),i("div",{key:0,class:"drag-preview-box",style:P(Ee())},[d(l,{icon:f(Ze)},null,8,["icon"]),e[20]||(e[20]=b("拖曳到這 ",-1))],4)):U("",!0),(u(!0),i(y,null,A(x.value,(a,n)=>(u(),i("div",{key:n,style:P(je(a)),class:"relative overflow-hidden rounded-lg bg-white shadow-lg"},[o("button",{class:"absolute left-2 top-2 z-10 cursor-move text-lg text-[#456882]",onMousedown:s=>ne(s,n),"on:touchStart":s=>ne(s,n)},[d(l,{icon:f(at)},null,8,["icon"])],40,Gt),(u(),H(nt,{key:n,"chart-json":a},null,8,["chart-json"]))],4))),128))],512),o("button",{class:"chart-options-btn",onClick:T},[d(l,{icon:f(et)},null,8,["icon"])])])}}}),It=st(Rt,[["__scopeId","data-v-6dcd162c"]]);export{It as default};
