import{d as fe,r as d,o as me,x as ye,a as c,b as r,e as o,w as be,g as p,h as A,u as f,y as he,j as ge,F as m,f as R,i as ke,z as we,A as _e,n as De,I as Ve,J as Se,t as y,m as C,k as U,l as T,v as E,Q as I,N as ae,O as ne,K as O,P as $e,T as se,R as oe,S as Re,D as Ce,V as je,_ as Ae}from"./index-DLame9wp.js";const Me={class:"container"},Ue={key:0,class:"flex h-[50vh] flex-col items-center justify-center gap-2 p-4 text-xl font-bold text-[#374151]"},Ee={class:"scroll-container"},ze={class:"grid h-full gap-4 sm:grid-cols-2"},Fe={class:"input-title"},Ne={class:"input-content"},Te=["placeholder","onUpdate:modelValue"],Ie=["placeholder","onUpdate:modelValue"],Oe=["placeholder","onUpdate:modelValue"],Pe=["placeholder","onUpdate:modelValue"],He=["onClick"],Le=["value","onUpdate:modelValue"],Ye=["onClick"],Be=["value","onUpdate:modelValue"],Qe={class:"quick-select"},We=["onClick"],Ge={class:"popup-footer"},Ke={class:"flex gap-4"},Xe={class:"relative flex items-center gap-2 rounded-full bg-[#DDDDDD] px-8 py-4 text-base text-[#44444e] shadow-lg"},xe={class:"w-fit flex-shrink-0 font-bold"},qe={class:"filter-tag-container"},Je={class:"filter-tag-text"},Ze=fe({__name:"MigrationView",setup(et){const i=d([]),P=d([]),z=d(!1),D=d({}),_=d({}),V=d({}),b=d({}),h=d({}),k=d({}),g=d({}),u=d({}),S=d({}),H=d({}),v=d({}),L=d({}),F=d(),$=d(180);function M(){B(),z.value=!z.value}function Y(t,e){t&&(H.value[e]=t,v.value[e]===void 0&&(v.value[e]=!1))}function N(t,e,l){t&&(l?S.value[`${e}-${l}`]=t:S.value[e]=t)}function B(){Object.keys(v.value).forEach(t=>{const e=parseInt(t,10);v.value[e]=!1})}function Q(t){const e=i.value[t];(e.type==="singleSelect"||e.type==="multiSelect")&&(v.value[t]=!v.value[t],v.value[t]&&je(()=>{W(t)}))}function W(t){const e=H.value[t];if(e){const l=e.getBoundingClientRect();L.value[t]={top:l.bottom,left:l.left,width:l.width}}}function G(t){const e=L.value[t];return e?{position:"fixed",top:`${e.top}px`,left:`${e.left}px`,width:`${e.width}px`,zIndex:1e4}:{}}function ue(t,e){const l=i.value[t];if(l)switch(l.type){case"dateRange":re(t,e);break;case"numberRange":Array.isArray(e)&&e.length===2?ce(t,e):console.warn("Invalid quick select value for numberRange: expected [number, number], got:",e);break;default:console.warn(`Quick select not supported for filter type: ${l.type}`)}}function re(t,e){const l=new Date;let a,n=new Date(l);switch(e){case"last_7_days":a=new Date(l),a.setDate(l.getDate()-7);break;case"last_30_days":a=new Date(l),a.setDate(l.getDate()-30);break;case"last_90_days":a=new Date(l),a.setDate(l.getDate()-90);break;case"this_month":a=new Date(l.getFullYear(),l.getMonth(),1),n=new Date(l.getFullYear(),l.getMonth()+1,0);break;case"last_month":a=new Date(l.getFullYear(),l.getMonth()-1,1),n=new Date(l.getFullYear(),l.getMonth(),0);break;case"this_year":a=new Date(l.getFullYear(),0,1),n=new Date(l.getFullYear(),11,31);break;case"last_year":a=new Date(l.getFullYear()-1,0,1),n=new Date(l.getFullYear()-1,11,31);break;default:console.warn(`Unknown quick select value: ${e}`);return}b.value[t]={start:a,end:n};const s=`${t}-start`,w=`${t}-end`;S.value[s]?.closeMenu(),S.value[w]?.closeMenu()}function ce(t,e){if(!Array.isArray(e)||e.length!==2){console.warn(`Invalid quick select value for numberRange: ${e}`);return}h.value[t]={start:e[0],end:e[1]}}function ie(){Object.keys(v.value).forEach(t=>{const e=parseInt(t,10);v.value[e]=!1}),Object.keys(S.value).forEach(t=>{S.value[t]?.closeMenu()})}function de(){Object.keys(v.value).forEach(t=>{const e=parseInt(t,10);v.value[e]&&W(e)})}function K(t,e){let l;return function(){l||(t(),l=!0,setTimeout(()=>l=!1,e))}}const X=K(de,200);function j(t){return t?typeof t=="string"?t:t.start:""}function x(t){return t?typeof t=="string"?t:t.end:""}function q(t,e){if(!e||!t.options)return"";const l=t.options.find(a=>a.value===e);return l?l.label:e}function J(t,e){return!e||!t.options?"":e.map(l=>{const a=t.options.find(n=>n.value===l);return a?a.label:l}).filter(Boolean).join(", ")}function Z(){Object.keys(D.value).forEach(t=>{const e=parseInt(t,10);D.value[e]?(u.value[e]=D.value[e],u.value[e]=i.value[e].label+": "+u.value[e]):delete u.value[e]}),Object.keys(_.value).forEach(t=>{const e=parseInt(t,10);_.value[e]!==void 0&&_.value[e]!==null?(u.value[e]=_.value[e].toString()+i.value[e].unit,u.value[e]=i.value[e].label+": "+u.value[e]):delete u.value[e]}),Object.keys(V.value).forEach(t=>{const e=parseInt(t,10);V.value[e]?(u.value[e]=V.value[e].toLocaleString(),u.value[e]=i.value[e].label+": "+u.value[e]):delete u.value[e]}),Object.keys(b.value).forEach(t=>{const e=parseInt(t,10),l=b.value[e];l&&l.start&&l.end?(u.value[e]=`${l.start.toLocaleString()} ~ ${l.end.toLocaleString()}`,u.value[e]=i.value[e].label+": "+u.value[e]):delete u.value[e]}),Object.keys(h.value).forEach(t=>{const e=parseInt(t,10),l=h.value[e];if(l&&l.start!==void 0&&l.end!==void 0){const a=i.value[e].unit;u.value[e]=`${l.start}${a} ~ ${l.end}${a}`,u.value[e]=i.value[e].label+": "+u.value[e]}else delete u.value[e]}),Object.keys(k.value).forEach(t=>{const e=parseInt(t,10),l=i.value[e];k.value[e]?(u.value[e]=q(l,k.value[e])||k.value[e],u.value[e]=i.value[e].label+": "+u.value[e]):delete u.value[e]}),Object.keys(g.value).forEach(t=>{const e=parseInt(t,10),l=i.value[e];g.value[e]&&g.value[e].length>0?(u.value[e]=J(l,g.value[e])||g.value[e].join(", "),u.value[e]=i.value[e].label+": "+u.value[e]):delete u.value[e]})}function ee(){i.value.forEach((t,e)=>{if(!(t.default===void 0||t.default==null))switch(t.type){case"text":D.value[e]=t.default||"";break;case"number":_.value[e]=t.default||0;break;case"date":V.value[e]=t.default?new Date(t.default):null;break;case"dateRange":if(t.default&&typeof t.default=="object"&&!Array.isArray(t.default)){const l=t.default;b.value[e]={start:new Date(l.start),end:new Date(l.end)}}else b.value[e]={start:null,end:null};break;case"numberRange":if(t.default&&typeof t.default=="object"&&!Array.isArray(t.default)){const l=t.default;h.value[e]={start:l.start,end:l.end}}else h.value[e]={start:0,end:0};break;case"singleSelect":k.value[e]=t.default||"";break;case"multiSelect":g.value[e]=t.default||[];break}}),B()}function ve(){Z(),M()}function te(){if(!F.value)return;const t=F.value.clientWidth;t<768||t<1024?$.value=80:t<1280?$.value=120:(t<1536,$.value=160)}function pe(t){const e=t.gridX||1,l=t.gridY||1,a=t.gridWidth||4,n=t.gridHeight||4,s=e+a,w=l+n;return{gridColumn:`${e} / ${s}`,gridRow:`${l} / ${w}`,minHeight:`${n*$.value}px`}}const le=K(te,100);return me(async()=>{try{const t="http://vms-dev-2062032097.ap-southeast-1.elb.amazonaws.com/chart/myagent/dashboard/charts-filters",e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const l=await e.json();l.filters&&(i.value=l.filters,ee(),Z()),te(),P.value=l.charts||[]}catch(t){console.error("Error fetching chart data:",t)}window.addEventListener("resize",X),window.addEventListener("resize",le)}),ye(()=>{window.removeEventListener("resize",X),window.removeEventListener("resize",le)}),(t,e)=>{const l=ge("FontAwesomeIcon");return r(),c("div",Me,[o("div",{class:De(["popup-model",{active:z.value}]),onClick:M},[o("div",{class:"popup-content shadow-lg",onClick:e[2]||(e[2]=be(()=>{},["stop"]))},[i.value.length==0?(r(),c("div",Ue,[p(l,{icon:f(he),class:"mb-2 text-6xl"},null,8,["icon"]),e[3]||(e[3]=A("沒有任何篩選項 ",-1))])):(r(),c("div",{key:1,class:"popup-body",onScroll:ie},[o("div",Ee,[o("div",ze,[(r(!0),c(m,null,R(i.value,(a,n)=>(r(),c("div",{key:n,class:"input-group"},[o("div",Fe,y(a.label),1),o("div",Ne,[a.type=="text"?C((r(),c("input",{key:0,class:"text-input",type:"text",placeholder:j(a.placeholder),"onUpdate:modelValue":s=>D.value[n]=s},null,8,Te)),[[E,D.value[n]]]):a.type=="date"?(r(),U(f(I),{key:1,ref_for:!0,ref:s=>N(s,n),placeholder:j(a.placeholder),modelValue:V.value[n],"onUpdate:modelValue":s=>V.value[n]=s,format:"yyyy-MM-dd HH:mm:ss","enable-time-picker":!0,locale:"zh-TW",teleport:!0,"z-index":1e4},null,8,["placeholder","modelValue","onUpdate:modelValue"])):a.type=="dateRange"?(r(),c(m,{key:2},[p(f(I),{ref_for:!0,ref:s=>N(s,n,"start"),placeholder:j(a.placeholder),modelValue:b.value[n].start,"onUpdate:modelValue":s=>b.value[n].start=s,format:"yyyy-MM-dd HH:mm:ss","enable-time-picker":!0,locale:"zh-TW",teleport:!0,"z-index":1e4},null,8,["placeholder","modelValue","onUpdate:modelValue"]),e[4]||(e[4]=o("span",null,"~",-1)),p(f(I),{ref_for:!0,ref:s=>N(s,n,"end"),placeholder:x(a.placeholder),modelValue:b.value[n].end,"onUpdate:modelValue":s=>b.value[n].end=s,format:"yyyy-MM-dd HH:mm:ss","enable-time-picker":!0,locale:"zh-TW",teleport:!0,"z-index":1e4},null,8,["placeholder","modelValue","onUpdate:modelValue"])],64)):a.type=="number"?(r(),c(m,{key:3},[C(o("input",{type:"number",placeholder:j(a.placeholder),"onUpdate:modelValue":s=>_.value[n]=s},null,8,Ie),[[E,_.value[n]]]),o("span",null,y(a.unit),1)],64)):a.type=="numberRange"?(r(),c(m,{key:4},[C(o("input",{type:"number",placeholder:j(a.placeholder),"onUpdate:modelValue":s=>h.value[n].start=s},null,8,Oe),[[E,h.value[n].start]]),o("span",null,y(a.unit),1),e[5]||(e[5]=o("span",null,"~",-1)),C(o("input",{type:"number",placeholder:x(a.placeholder),"onUpdate:modelValue":s=>h.value[n].end=s},null,8,Pe),[[E,h.value[n].end]]),o("span",null,y(a.unit),1)],64)):a.type=="singleSelect"?(r(),c(m,{key:5},[o("div",{class:"select-title",ref_for:!0,ref:s=>Y(s,n),onClick:s=>Q(n)},[o("span",null,y(q(a,k.value[n])||a.placeholder),1),p(l,{icon:f(ae)},null,8,["icon"])],8,He),p(oe,{name:"fade",mode:"out-in"},{default:ne(()=>[(r(),U(se,{to:"body"},[v.value[n]?(r(),c("div",{key:0,class:"select-options",style:O(G(n))},[(r(!0),c(m,null,R(a.options,s=>(r(),c("label",{key:s.value},[C(o("input",{type:"radio",value:s.value,"onUpdate:modelValue":w=>k.value[n]=w},null,8,Le),[[$e,k.value[n]]]),o("span",null,y(s.label),1)]))),128))],4)):T("",!0)]))]),_:2},1024)],64)):a.type=="multiSelect"?(r(),c(m,{key:6},[o("div",{class:"select-title",ref_for:!0,ref:s=>Y(s,n),onClick:s=>Q(n)},[o("span",null,y(J(a,g.value[n])||a.placeholder),1),p(l,{icon:f(ae)},null,8,["icon"])],8,Ye),p(oe,{name:"fade",mode:"out-in"},{default:ne(()=>[(r(),U(se,{to:"body"},[v.value[n]?(r(),c("div",{key:0,class:"select-options",style:O(G(n))},[(r(!0),c(m,null,R(a.options,s=>(r(),c("label",{key:s.value},[C(o("input",{type:"checkbox",value:s.value,"onUpdate:modelValue":w=>g.value[n]=w},null,8,Be),[[Re,g.value[n]]]),o("span",null,y(s.label),1)]))),128))],4)):T("",!0)]))]),_:2},1024)],64)):T("",!0)]),o("div",Qe,[(r(!0),c(m,null,R(a.quickSelect,s=>(r(),c("button",{key:s.label,onClick:w=>ue(n,s.value)},y(s.label),9,We))),128))])]))),128))])])],32)),o("div",Ge,[o("button",{class:"flex w-[8rem] items-center justify-center rounded-full bg-gray-500 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-600",onClick:M},[p(l,{icon:f(ke),class:"mr-1"},null,8,["icon"]),e[6]||(e[6]=A("關閉 ",-1))]),o("div",Ke,[o("button",{class:"flex w-[8rem] items-center justify-center rounded-full bg-blue-400 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-500",onClick:e[0]||(e[0]=a=>ee())},[p(l,{icon:f(we),class:"mr-1"},null,8,["icon"]),e[7]||(e[7]=A("重置 ",-1))]),o("button",{class:"flex w-[8rem] items-center justify-center rounded-full bg-blue-500 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-600",onClick:e[1]||(e[1]=a=>ve())},[p(l,{icon:f(_e),class:"mr-1"},null,8,["icon"]),e[8]||(e[8]=A("套用 ",-1))])])])])],2),o("div",Xe,[o("span",xe,[p(l,{icon:f(Ve),class:"text-[#456882]"},null,8,["icon"]),e[9]||(e[9]=A(" 篩選項 ",-1))]),o("div",qe,[(r(!0),c(m,null,R(u.value,(a,n)=>(r(),c("div",{class:"filter-tag",key:n},[e[10]||(e[10]=o("div",{class:"filter-tag-hole"},null,-1)),o("span",Je,y(a),1)]))),128))]),o("button",{class:"text-base text-[#456882]",onClick:M},[p(l,{icon:f(Se)},null,8,["icon"])])]),o("div",{ref_key:"chartGridRef",ref:F,class:"chart-grid mt-6"},[(r(!0),c(m,null,R(P.value,(a,n)=>(r(),c("div",{key:n,style:O(pe(a)),class:"overflow-hidden rounded-lg bg-white shadow-lg"},[(r(),U(Ce,{key:n,"chart-json":a},null,8,["chart-json"]))],4))),128))],512)])}}}),lt=Ae(Ze,[["__scopeId","data-v-23f4b337"]]);export{lt as default};
