import{cO as fa,W as la,V as X,cP as ca,cQ as ua,cR as ha,cS as da,bL as ea,aU as Y,S as W,ai as ya,aJ as $,aq as I,cT as Ma,cU as pa,cV as ma,cW as Ca,cX as Da,b6 as g,cx as na,cr as oa,b8 as ba,av as ia,cY as sa,cZ as H,c_ as Sa,au as ga,aC as xa,c$ as Ta,d0 as La,cv as Z}from"./index-DKEVGSxg.js";function za(r,e){return Pa(r,e).dimensions}function Pa(r,e){fa(r)||(r=la(r)),e=e||{};var i=e.coordDimensions||[],a=e.dimensionsDefine||r.dimensionsDefine||[],n=X(),s=[],v=ka(r,i,a,e.dimensionsCount),f=e.canOmitUnusedDimensions&&ca(v),c=a===r.dimensionsDefine,l=c?ua(r):ha(a),o=e.encodeDefine;!o&&e.encodeDefaulter&&(o=e.encodeDefaulter(r,v));for(var u=X(o),p=new da(v),t=0;t<p.length;t++)p[t]=-1;function m(M){var b=p[M];if(b<0){var S=a[M],k=I(S)?S:{name:S},h=new Da,R=k.name;R!=null&&l.get(R)!=null&&(h.name=h.displayName=R),k.type!=null&&(h.type=k.type),k.displayName!=null&&(h.displayName=k.displayName);var T=s.length;return p[M]=T,h.storeDimIndex=M,s.push(h),h}return s[b]}if(!f)for(var t=0;t<v;t++)m(t);u.each(function(M,b){var S=ea(M).slice();if(S.length===1&&!Y(S[0])&&S[0]<0){u.set(b,!1);return}var k=u.set(b,[]);W(S,function(h,R){var T=Y(h)?l.get(h):h;T!=null&&T<v&&(k[R]=T,D(m(T),b,R))})});var y=0;W(i,function(M){var b,S,k,h;if(Y(M))b=M,h={};else{h=M,b=h.name;var R=h.ordinalMeta;h.ordinalMeta=null,h=ya({},h),h.ordinalMeta=R,S=h.dimsDef,k=h.otherDims,h.name=h.coordDim=h.coordDimIndex=h.dimsDef=h.otherDims=null}var T=u.get(b);if(T!==!1){if(T=ea(T),!T.length)for(var aa=0;aa<(S&&S.length||1);aa++){for(;y<v&&m(y).coordDim!=null;)y++;y<v&&T.push(y++)}W(T,function(ta,ra){var _=m(ta);if(c&&h.type!=null&&(_.type=h.type),D($(_,h),b,ra),_.name==null&&S){var E=S[ra];!I(E)&&(E={name:E}),_.name=_.displayName=E.name,_.defaultTooltip=E.defaultTooltip}k&&$(_.otherDims,k)})}});function D(M,b,S){Ma.get(b)!=null?M.otherDims[b]=S:(M.coordDim=b,M.coordDimIndex=S,n.set(b,!0))}var w=e.generateCoord,L=e.generateCoordCount,G=L!=null;L=w?L||1:0;var U=w||"value";function z(M){M.name==null&&(M.name=M.coordDim)}if(f)W(s,function(M){z(M)}),s.sort(function(M,b){return M.storeDimIndex-b.storeDimIndex});else for(var B=0;B<v;B++){var P=m(B),Q=P.coordDim;Q==null&&(P.coordDim=Aa(U,n,G),P.coordDimIndex=0,(!w||L<=0)&&(P.isExtraCoord=!0),L--),z(P),P.type==null&&(pa(r,B)===ma.Must||P.isExtraCoord&&(P.otherDims.itemName!=null||P.otherDims.seriesName!=null))&&(P.type="ordinal")}return wa(s),new Ca({source:r,dimensions:s,fullDimensionCount:v,dimensionOmitted:f})}function wa(r){for(var e=X(),i=0;i<r.length;i++){var a=r[i],n=a.name,s=e.get(n)||0;s>0&&(a.name=n+(s-1)),s++,e.set(n,s)}}function ka(r,e,i,a){var n=Math.max(r.dimensionsDetectedCount||1,e.length,i.length,a||0);return W(e,function(s){var v;I(s)&&(v=s.dimsDef)&&(n=Math.max(n,v.length))}),n}function Aa(r,e,i){if(i||e.hasKey(r)){for(var a=0;e.hasKey(r+a);)a++;r+=a}return e.set(r,!0),r}var V=Math.PI*2,N=xa.CMD,ja=["top","right","bottom","left"];function Oa(r,e,i,a,n){var s=i.width,v=i.height;switch(r){case"top":a.set(i.x+s/2,i.y-e),n.set(0,-1);break;case"bottom":a.set(i.x+s/2,i.y+v+e),n.set(0,1);break;case"left":a.set(i.x-e,i.y+v/2),n.set(-1,0);break;case"right":a.set(i.x+s+e,i.y+v/2),n.set(1,0);break}}function qa(r,e,i,a,n,s,v,f,c){v-=r,f-=e;var l=Math.sqrt(v*v+f*f);v/=l,f/=l;var o=v*i+r,u=f*i+e;if(Math.abs(a-n)%V<1e-4)return c[0]=o,c[1]=u,l-i;if(s){var p=a;a=Z(n),n=Z(p)}else a=Z(a),n=Z(n);a>n&&(n+=V);var t=Math.atan2(f,v);if(t<0&&(t+=V),t>=a&&t<=n||t+V>=a&&t+V<=n)return c[0]=o,c[1]=u,l-i;var m=i*Math.cos(a)+r,y=i*Math.sin(a)+e,D=i*Math.cos(n)+r,w=i*Math.sin(n)+e,L=(m-v)*(m-v)+(y-f)*(y-f),G=(D-v)*(D-v)+(w-f)*(w-f);return L<G?(c[0]=m,c[1]=y,Math.sqrt(L)):(c[0]=D,c[1]=w,Math.sqrt(G))}function F(r,e,i,a,n,s,v,f){var c=n-r,l=s-e,o=i-r,u=a-e,p=Math.sqrt(o*o+u*u);o/=p,u/=p;var t=c*o+l*u,m=t/p;f&&(m=Math.min(Math.max(m,0),1)),m*=p;var y=v[0]=r+m*o,D=v[1]=e+m*u;return Math.sqrt((y-n)*(y-n)+(D-s)*(D-s))}function va(r,e,i,a,n,s,v){i<0&&(r=r+i,i=-i),a<0&&(e=e+a,a=-a);var f=r+i,c=e+a,l=v[0]=Math.min(Math.max(n,r),f),o=v[1]=Math.min(Math.max(s,e),c);return Math.sqrt((l-n)*(l-n)+(o-s)*(o-s))}var A=[];function Ga(r,e,i){var a=va(e.x,e.y,e.width,e.height,r.x,r.y,A);return i.set(A[0],A[1]),a}function Ua(r,e,i){for(var a=0,n=0,s=0,v=0,f,c,l=1/0,o=e.data,u=r.x,p=r.y,t=0;t<o.length;){var m=o[t++];t===1&&(a=o[t],n=o[t+1],s=a,v=n);var y=l;switch(m){case N.M:s=o[t++],v=o[t++],a=s,n=v;break;case N.L:y=F(a,n,o[t],o[t+1],u,p,A,!0),a=o[t++],n=o[t++];break;case N.C:y=La(a,n,o[t++],o[t++],o[t++],o[t++],o[t],o[t+1],u,p,A),a=o[t++],n=o[t++];break;case N.Q:y=Ta(a,n,o[t++],o[t++],o[t],o[t+1],u,p,A),a=o[t++],n=o[t++];break;case N.A:var D=o[t++],w=o[t++],L=o[t++],G=o[t++],U=o[t++],z=o[t++];t+=1;var B=!!(1-o[t++]);f=Math.cos(U)*L+D,c=Math.sin(U)*G+w,t<=1&&(s=f,v=c);var P=(u-D)*G/L+D;y=qa(D,w,G,U,U+z,B,P,p,A),a=Math.cos(U+z)*L+D,n=Math.sin(U+z)*G+w;break;case N.R:s=a=o[t++],v=n=o[t++];var Q=o[t++],M=o[t++];y=va(s,v,Q,M,u,p,A);break;case N.Z:y=F(a,n,s,v,u,p,A,!0),a=s,n=v;break}y<l&&(l=y,i.set(A[0],A[1]))}return l}var j=new g,d=new g,C=new g,q=new g,O=new g;function Ba(r,e){if(r){var i=r.getTextGuideLine(),a=r.getTextContent();if(a&&i){var n=r.textGuideLineConfig||{},s=[[0,0],[0,0],[0,0]],v=n.candidates||ja,f=a.getBoundingRect().clone();f.applyTransform(a.getComputedTransform());var c=1/0,l=n.anchor,o=r.getComputedTransform(),u=o&&Sa([],o),p=e.get("length2")||0;l&&C.copy(l);for(var t=0;t<v.length;t++){var m=v[t];Oa(m,0,f,j,q),g.scaleAndAdd(d,j,q,p),d.transform(u);var y=r.getBoundingRect(),D=l?l.distance(d):r instanceof ga?Ua(d,r.path,C):Ga(d,y,C);D<c&&(c=D,d.transform(o),C.transform(o),C.toArray(s[0]),d.toArray(s[1]),j.toArray(s[2]))}Ra(s,e.get("minTurnAngle")),i.setShape({points:s})}}}var K=[],x=new g;function Ra(r,e){if(e<=180&&e>0){e=e/180*Math.PI,j.fromArray(r[0]),d.fromArray(r[1]),C.fromArray(r[2]),g.sub(q,j,d),g.sub(O,C,d);var i=q.len(),a=O.len();if(!(i<.001||a<.001)){q.scale(1/i),O.scale(1/a);var n=q.dot(O),s=Math.cos(e);if(s<n){var v=F(d.x,d.y,C.x,C.y,j.x,j.y,K,!1);x.fromArray(K),x.scaleAndAdd(O,v/Math.tan(Math.PI-e));var f=C.x!==d.x?(x.x-d.x)/(C.x-d.x):(x.y-d.y)/(C.y-d.y);if(isNaN(f))return;f<0?g.copy(x,d):f>1&&g.copy(x,C),x.toArray(r[1])}}}}function Ea(r,e,i){if(i<=180&&i>0){i=i/180*Math.PI,j.fromArray(r[0]),d.fromArray(r[1]),C.fromArray(r[2]),g.sub(q,d,j),g.sub(O,C,d);var a=q.len(),n=O.len();if(!(a<.001||n<.001)){q.scale(1/a),O.scale(1/n);var s=q.dot(e),v=Math.cos(i);if(s<v){var f=F(d.x,d.y,C.x,C.y,j.x,j.y,K,!1);x.fromArray(K);var c=Math.PI/2,l=Math.acos(O.dot(e)),o=c+l-i;if(o>=c)g.copy(x,C);else{x.scaleAndAdd(O,f/Math.tan(Math.PI/2-o));var u=C.x!==d.x?(x.x-d.x)/(C.x-d.x):(x.y-d.y)/(C.y-d.y);if(isNaN(u))return;u<0?g.copy(x,d):u>1&&g.copy(x,C)}x.toArray(r[1])}}}}function J(r,e,i,a){var n=i==="normal",s=n?r:r.ensureState(i);s.ignore=e;var v=a.get("smooth");v&&v===!0&&(v=.3),s.shape=s.shape||{},v>0&&(s.shape.smooth=v);var f=a.getModel("lineStyle").getLineStyle();n?r.useStyle(f):s.style=f}function _a(r,e){var i=e.smooth,a=e.points;if(a)if(r.moveTo(a[0][0],a[0][1]),i>0&&a.length>=3){var n=sa(a[0],a[1]),s=sa(a[1],a[2]);if(!n||!s){r.lineTo(a[1][0],a[1][1]),r.lineTo(a[2][0],a[2][1]);return}var v=Math.min(n,s)*i,f=H([],a[1],a[0],v/n),c=H([],a[1],a[2],v/s),l=H([],f,c,.5);r.bezierCurveTo(f[0],f[1],f[0],f[1],l[0],l[1]),r.bezierCurveTo(c[0],c[1],c[0],c[1],a[2][0],a[2][1])}else for(var o=1;o<a.length;o++)r.lineTo(a[o][0],a[o][1])}function Va(r,e,i){var a=r.getTextGuideLine(),n=r.getTextContent();if(!n){a&&r.removeTextGuideLine();return}for(var s=e.normal,v=s.get("show"),f=n.ignore,c=0;c<na.length;c++){var l=na[c],o=e[l],u=l==="normal";if(o){var p=o.get("show"),t=u?f:oa(n.states[l]&&n.states[l].ignore,f);if(t||!oa(p,v)){var m=u?a:a&&a.states[l];m&&(m.ignore=!0),a&&J(a,!0,l,o);continue}a||(a=new ba,r.setTextGuideLine(a),!u&&(f||!v)&&J(a,!0,"normal",e.normal),r.stateProxy&&(a.stateProxy=r.stateProxy)),J(a,!1,l,o)}}if(a){$(a.style,i),a.style.fill=null;var y=s.get("showAbove"),D=r.textGuideLineConfig=r.textGuideLineConfig||{};D.showAbove=y||!1,a.buildPath=_a}}function Wa(r,e){e=e||"labelLine";for(var i={normal:r.getModel(e)},a=0;a<ia.length;a++){var n=ia[a];i[n]=r.getModel([n,e])}return i}export{Ea as a,za as c,Wa as g,Ra as l,Pa as p,Va as s,Ba as u};
